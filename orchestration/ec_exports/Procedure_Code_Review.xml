<?xml version="1.0" encoding="UTF-8"?>
<exportedData version="63" buildLabel="build_5.0_73229_2014.05.25_05:29:38" buildVersion="5.0.1.73229" passkey="95daec80877f164f13935bac14adde8cf636fe7b">
  <exportPath>/projects/Demo/procedures/Code_Review</exportPath>
  <procedure>
    <procedureName>Code_Review</procedureName>
    <description></description>
    <jobNameTemplate></jobNameTemplate>
    <resourceName>$[resource]</resourceName>
    <timeLimit></timeLimit>
    <timeLimitUnits>minutes</timeLimitUnits>
    <workspaceName></workspaceName>
    <propertySheet>
      <property>
        <propertyName>ec_customEditorData</propertyName>
        <propertySheet>
          <property>
            <propertyName>parameters</propertyName>
            <propertySheet>
              <property>
                <propertyName>resource</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>review_description</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>review_summary</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>source_directory</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </property>
    </propertySheet>
    <formalParameter>
      <formalParameterName>resource</formalParameterName>
      <defaultValue>build</defaultValue>
      <description></description>
      <expansionDeferred>0</expansionDeferred>
      <required>0</required>
      <type>entry</type>
    </formalParameter>
    <formalParameter>
      <formalParameterName>review_description</formalParameterName>
      <defaultValue></defaultValue>
      <description></description>
      <expansionDeferred>0</expansionDeferred>
      <required>1</required>
      <type>entry</type>
    </formalParameter>
    <formalParameter>
      <formalParameterName>review_summary</formalParameterName>
      <defaultValue></defaultValue>
      <description></description>
      <expansionDeferred>0</expansionDeferred>
      <required>1</required>
      <type>entry</type>
    </formalParameter>
    <formalParameter>
      <formalParameterName>source_directory</formalParameterName>
      <defaultValue></defaultValue>
      <description></description>
      <expansionDeferred>0</expansionDeferred>
      <required>1</required>
      <type>entry</type>
    </formalParameter>
    <step>
      <stepName>Create</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <command>cd $[source_directory]&#10;echo "REVIEWBOARD_URL = 'https://rbcommons.com/s/ecdemo/'" &gt; .reviewboardrc&#10;echo "REPOSITORY = 'dockercon'" &gt;&gt; .reviewboardrc&#10;post-review --username tanaynagjee --password changeme --parent=HEAD --target-people tanaynagjee --description="$[review_description]" --summary="$[review_summary]" --publish&#10;</command>
      <condition></condition>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>none</exclusiveMode>
      <logFileName></logFileName>
      <parallel>0</parallel>
      <postProcessor>postp --loadProperty /myProject/postp</postProcessor>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <shell></shell>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workingDirectory></workingDirectory>
      <workspaceName></workspaceName>
      <propertySheet>
      </propertySheet>
    </step>
    <step>
      <stepName>Wait</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <command>use strict;&#10;use warnings;&#10;use LWP;&#10;use JSON qw( decode_json );&#10;use ElectricCommander;&#10;use Data::Dumper;&#10;&#10;my $ec = new ElectricCommander;&#10;&#10;my $browser = LWP::UserAgent-&gt;new;&#10;my $url = "https://rbcommons.com/s/ecdemo/api/review-requests/$[request_id]/";&#10;my $req = HTTP::Request-&gt;new(GET =&gt; $url);&#10;$req-&gt;authorization_basic("tanaynagjee", "changeme");&#10;&#10;my $status = 'pending';&#10;do {&#10;    my $response = $browser-&gt;request($req);&#10;    if ($response-&gt;is_error) {&#10;        if ($response-&gt;status_line ne '') {&#10;            print "Error: " . $response-&gt;status_line;&#10;        } else {&#10;            print "Error: Unable to retrieve URL $url";&#10;        }&#10;        exit;&#10;    }&#10;    my $decoded = decode_json($response-&gt;content());&#10;    $status = $decoded-&gt;{'review_request'}-&gt;{'status'};&#10;    if ($status eq 'pending') {&#10;        sleep 5;&#10;    }&#10;} while ($status eq 'pending');&#10;$ec-&gt;setProperty("summary", "Status: $status");&#10;if ($status eq 'discarded') {&#10;    print "Review was rejected!";&#10;    exit 1;&#10;}&#10;print "Review was accepted!";</command>
      <condition></condition>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>none</exclusiveMode>
      <logFileName></logFileName>
      <parallel>0</parallel>
      <postProcessor>postp</postProcessor>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <shell>ec-perl</shell>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workingDirectory></workingDirectory>
      <workspaceName></workspaceName>
      <propertySheet>
      </propertySheet>
    </step>
  </procedure>
</exportedData>
