<?xml version="1.0" encoding="UTF-8"?>
<exportedData version="63" buildLabel="build_5.0_73229_2014.05.25_05:29:38" buildVersion="5.0.1.73229" passkey="95daec80877f164f13935bac14adde8cf636fe7b">
  <exportPath>/projects/Demo/procedures/Deploy_Production</exportPath>
  <procedure>
    <procedureName>Deploy_Production</procedureName>
    <description></description>
    <jobNameTemplate></jobNameTemplate>
    <resourceName>$[resource]</resourceName>
    <timeLimit></timeLimit>
    <timeLimitUnits>minutes</timeLimitUnits>
    <workspaceName></workspaceName>
    <propertySheet>
      <property>
        <propertyName>ec_customEditorData</propertyName>
        <propertySheet>
          <property>
            <propertyName>parameters</propertyName>
            <propertySheet>
              <property>
                <propertyName>build_id</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>port</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
              <property>
                <propertyName>resource</propertyName>
                <propertySheet>
                  <property>
                    <propertyName>formType</propertyName>
                    <expandable>1</expandable>
                    <value>standard</value>
                  </property>
                </propertySheet>
              </property>
            </propertySheet>
          </property>
        </propertySheet>
      </property>
    </propertySheet>
    <formalParameter>
      <formalParameterName>build_id</formalParameterName>
      <defaultValue>$[/myProject/build_id]</defaultValue>
      <description></description>
      <expansionDeferred>0</expansionDeferred>
      <required>0</required>
      <type>entry</type>
    </formalParameter>
    <formalParameter>
      <formalParameterName>resource</formalParameterName>
      <defaultValue>production</defaultValue>
      <description></description>
      <expansionDeferred>0</expansionDeferred>
      <required>0</required>
      <type>entry</type>
    </formalParameter>
    <step>
      <stepName>Retrieve container</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <condition></condition>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>none</exclusiveMode>
      <parallel>0</parallel>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <subprocedure>Retrieve</subprocedure>
      <subproject>/plugins/EC-Artifact/project</subproject>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workspaceName></workspaceName>
      <actualParameters>
        <property>
          <propertyName>artifactName</propertyName>
          <expandable>1</expandable>
          <value>jpetstore:container</value>
        </property>
        <property>
          <propertyName>artifactVersionLocationProperty</propertyName>
          <expandable>1</expandable>
          <value>/myJob/artifacts</value>
        </property>
        <property>
          <propertyName>filterList</propertyName>
          <expandable>1</expandable>
          <value></value>
        </property>
        <property>
          <propertyName>overwrite</propertyName>
          <expandable>1</expandable>
          <value>update</value>
        </property>
        <property>
          <propertyName>versionRange</propertyName>
          <expandable>1</expandable>
          <value>$[build_id]</value>
        </property>
      </actualParameters>
      <propertySheet>
      </propertySheet>
    </step>
    <step>
      <stepName>Arrange</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <command>rm -rf /opt/jpetstore/$[build_id]&#10;mkdir /opt/jpetstore/$[build_id]&#10;cp -R $[/myJob/artifacts/jpetstore:container/cacheLocation] /opt/jpetstore/$[build_id]/docker</command>
      <condition></condition>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>none</exclusiveMode>
      <logFileName></logFileName>
      <parallel>0</parallel>
      <postProcessor></postProcessor>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <shell></shell>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workingDirectory></workingDirectory>
      <workspaceName></workspaceName>
      <propertySheet>
      </propertySheet>
    </step>
    <step>
      <stepName>Target port</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <command>ectool setProperty /myParent/target_port $[/javascript myProject.production_active == 8080 ? 8081 : 8080]</command>
      <condition></condition>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>job</exclusiveMode>
      <logFileName></logFileName>
      <parallel>0</parallel>
      <postProcessor>postp</postProcessor>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <shell></shell>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workingDirectory></workingDirectory>
      <workspaceName></workspaceName>
      <propertySheet>
      </propertySheet>
    </step>
    <step>
      <stepName>Deploy</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <command>docker ps|grep '$[target_port]-&gt;8080'|awk '{ print "docker rm -f "$1"" }'|sh&#10;cd /opt/jpetstore/$[build_id]/docker&#10;docker build -t nikhilv/jpetstore-$[target_port] .&#10;docker run -p $[target_port]:8080 nikhilv/jpetstore-$[target_port] &amp;&#10;sleep 5&#10;etcdctl set ecdemo/upstream $[target_port]&#10;confd -node 'http://127.0.0.1:4001' -onetime -confdir /etc/confd</command>
      <condition></condition>
      <credentialName>production_root</credentialName>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>none</exclusiveMode>
      <logFileName></logFileName>
      <parallel>0</parallel>
      <postProcessor></postProcessor>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <shell></shell>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workingDirectory></workingDirectory>
      <workspaceName></workspaceName>
      <propertySheet>
      </propertySheet>
    </step>
    <step>
      <stepName>Save port</stepName>
      <alwaysRun>0</alwaysRun>
      <broadcast>0</broadcast>
      <command>ectool setProperty /myProject/production_active $[target_port]</command>
      <condition></condition>
      <description></description>
      <errorHandling>failProcedure</errorHandling>
      <exclusiveMode>job</exclusiveMode>
      <logFileName></logFileName>
      <parallel>0</parallel>
      <postProcessor>postp</postProcessor>
      <precondition></precondition>
      <releaseMode>none</releaseMode>
      <resourceName></resourceName>
      <shell></shell>
      <timeLimit></timeLimit>
      <timeLimitUnits>minutes</timeLimitUnits>
      <workingDirectory></workingDirectory>
      <workspaceName></workspaceName>
      <propertySheet>
      </propertySheet>
    </step>
  </procedure>
</exportedData>
